Tokens
token_id: identifier
type: enum(access_token, auth_code, device, device_code)
expiration: datetime
user_id: identifier
client_id: identifier

	// access_token
	private_key: string

	// auth_code
	redirect_uri: string

	// device_code
	user_code: string
	verfication_uri: string
	verification_uri_complete: string
	last_polled_at: datetime
	interval: int
	user_approved: bool

RefreshTokens
refresh_token_id: identifier
expiration: datetime
access_token_id: identifier

Scopes
scope_id: identifier
token_id: identifier

Clients
client_id: identifier
name: string
redirect_uri: string
is_confidential: boolean

Users
user_id: identifier

-- 2. Clients (ClientRepository)
-- Stores applications allowed to use your API.
CREATE TABLE oauth_clients (
id VARCHAR(80) PRIMARY KEY, -- 'client_id' (string or int, but strings allow UUIDs)
secret VARCHAR(255),        -- 'client_secret' (hashed!) - Nullable for public clients
name VARCHAR(255) NOT NULL, -- Friendly name (e.g., "My iOS App")
redirect_uri TEXT NOT NULL, -- Allowed callbacks. Use TEXT to allow multiple comma-separated URIs.
is_confidential TINYINT(1) DEFAULT 0, -- 1 = Confidential (Server-side), 0 = Public (JS/Mobile)
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- 3. Scopes (ScopeRepository)
-- Defines permissions (e.g., 'profile', 'email', 'read_posts').
CREATE TABLE oauth_scopes (
id VARCHAR(80) PRIMARY KEY, -- The scope string (e.g. 'user:read')
description VARCHAR(255)    -- Human-readable description for the consent screen
);

-- 4. Access Tokens (AccessTokenRepository)
-- The short-lived tokens used to access the API.
CREATE TABLE oauth_access_tokens (
id VARCHAR(100) PRIMARY KEY, -- The JTI (Token ID) generated by the library
user_id INT NULL,            -- Links to users table. NULL if using Client Credentials grant.
client_id VARCHAR(80) NOT NULL,
scopes TEXT,                 -- JSON array or space-separated list of scopes granted
revoked TINYINT(1) DEFAULT 0,-- 1 if the token has been manually killed
expires_at DATETIME,
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    FOREIGN KEY (client_id) REFERENCES oauth_clients(id) ON DELETE CASCADE
    -- Note: We generally don't FK user_id strictly if you want to support non-user tokens,
    -- but you can add it if all tokens are user-bound.
);

-- 5. Refresh Tokens (RefreshTokenRepository)
-- Long-lived tokens used to get new Access Tokens.
CREATE TABLE oauth_refresh_tokens (
id VARCHAR(100) PRIMARY KEY,
access_token_id VARCHAR(100) NOT NULL, -- Links to the parent access token
revoked TINYINT(1) DEFAULT 0,
expires_at DATETIME,

    FOREIGN KEY (access_token_id) REFERENCES oauth_access_tokens(id) ON DELETE CASCADE
);

-- 6. Authorization Codes (AuthCodeRepository)
-- Temporary codes used in the "Authorization Code" grant.
CREATE TABLE oauth_auth_codes (
id VARCHAR(100) PRIMARY KEY,
user_id INT NOT NULL,        -- The user who approved the login
client_id VARCHAR(80) NOT NULL,
scopes TEXT,                 -- Scopes requested
revoked TINYINT(1) DEFAULT 0,
expires_at DATETIME,
redirect_uri TEXT,           -- The specific URI used in this request (must verify on exchange)

    FOREIGN KEY (client_id) REFERENCES oauth_clients(id) ON DELETE CASCADE
);